<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Statistiques des messages commerciaux</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 0;
            background: #181a1b;
            color: #e0e0e0;
        }
        .navbar {
            background: #23272f !important;
        }
        .navbar .navbar-brand, .navbar .nav-link {
            color: #e0e0e0 !important;
        }
        .navbar .nav-link.active, .navbar .nav-link:hover {
            color: #00bcd4 !important;
        }
        .container {
            background: #23272f;
            border-radius: 16px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.4);
            padding: 32px 24px;
            margin-top: 32px;
        }
        h1, h2, h3 {
            color: #00bcd4;
        }
        #chart-container {
            width: 80vw;
            max-width: 900px;
            margin: auto;
            background: #22242a;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        .btn-primary {
            background: #00bcd4;
            border: none;
        }
        .btn-primary:hover {
            background: #0097a7;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="/">Dashboard Ikea</a>
        <div class="collapse navbar-collapse">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item"><a class="nav-link" href="/">Présentation</a></li>
                <li class="nav-item active"><a class="nav-link" href="/page1">Messages commerciaux</a></li>
                <li class="nav-item"><a class="nav-link" href="/page2">Nombre de reviews</a></li>
                <li class="nav-item"><a class="nav-link" href="/page3">Ranking</a></li>
                
                <li class="nav-item"><a class="nav-link" href="/search_es">Commentaires</a></li>
            </ul>
        </div>
    </nav>
    <h1>Statistiques des messages commerciaux par catégorie</h1>
    <div id="chart-container">
        <canvas id="barChart"></canvas>
        <div class="mt-4" style="background:#22242a; border-radius:10px; padding:18px; color:#b0b0b0;">
            <h5>Comment interpréter ce graphique&nbsp;?</h5>
            <p>Ce graphique montre le nombre de produits par catégorie et par type de message commercial. Il permet d’identifier les catégories les plus actives commercialement et les types de messages les plus utilisés.</p>
        </div>
    </div>
    <script>
        // Les données doivent être injectées depuis Flask
        const categories = {{ categories|tojson }};
        const message_types = {{ message_types|tojson }};
        const data_counts = {{ data_counts|tojson }};

        const datasets = message_types.map((msg, idx) => ({
            label: msg,
            data: data_counts[idx],
            backgroundColor: [
                '#4e79a7', // Nouveau
                '#f28e2b', // Prix le plus bas
                '#e15759', // Autre
                '#76b7b2', // Autre
                '#59a14f', // Autre
            ][idx] || '#aaa',
            stack: 'Stack 0',
        }));

        const ctx = document.getElementById('barChart').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: categories,
                datasets: datasets
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { position: 'top' },
                    title: {
                        display: true,
                        text: 'Nombre de produits par catégorie et message commercial'
                    }
                },
                scales: {
                    x: { stacked: true },
                    y: { stacked: true, beginAtZero: true }
                }
            }
        });
    </script>
</body>
</html>
